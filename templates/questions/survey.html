{% extends 'questions/base.html' %}
{% block title %}
    پرسشنامه
    {{ title }}
{% endblock %}
{% block content %}
    <form method="post">
        {% csrf_token %}
        {% for element in responder_form %}
            {{ element }}
        {% endfor %}
        {% for element in answerSheet_form %}
            {{ element }}
        {% endfor %}
        <div class="hide error interviewer_code_error">مقدار وارد شده در کد پرسگر نا معتبر است</div>
        {% for element in interviewer_form %}
            {{ element }}
        {% endfor %}
        <button type="submit" class="btn btn-primary btn-lg">ادامه</button>
    </form>
{% endblock %}
{% block js %}
    <script>
        let interviewer_code = $('.interviewer_code')
        interviewer_code.keyup(function () {
            if (this.value.length == 5) {
                $('.interviewer_code_error').addClass('hide')
                var serializedData = $(this).serialize();
                $.ajax({
                    url: '{% url 'Survey:interviewer_get_name_ajax' %}',
                    data: serializedData,
                    success: function (response) {
                        let text=JSON.stringify(response['name'])
                        $('.interviewer_name').val(JSON.stringify(response['name']))
                    },
                    error: function (response) {
                        console.log('error')
                        alert(response["responseJSON"]["error"]);
                        //$('.interviewer_name').val(JSON.stringify(response['error']))
                    }
                });
            } else {
                $('.interviewer_code_error').removeClass('hide')
            }
        })
    </script>
{% endblock %}