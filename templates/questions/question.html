{% extends 'questions/base.html' %}
{% block title %}
    اطلاعات پاسخگو
{% endblock %}
{% block extra_head %}
    <style type="text/css">
        .table1, .table2, .table3 {
            display: none;
        }

        .show {
            display: block;
        }

        table {
            font-family: arial, sans-serif;
            border-collapse: collapse;
            width: 100%;
        }

        td, th {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
        }

        tbody tr:hover {
            background-color: lightblue;
        }
    </style>
{% endblock %}
{% block welcome %}
    <div class="custom_container">
        <h4> {{ AmOrPm }}
            بخیر من
            {{ Who_is }}
            از شرکت تحقیقات بازار آگاه هستم. ما در حال انجام پژوهشی در مورد
            {{ survey_title }}
            برای بهتر شدن
            سرویس دهی {{ survey_title }} می باشیم، لطفا دقایقی از وقت خود را به ما اختصاص داده و در این نظرسنجی شرکت
            کنید</h4>
    </div>
{% endblock %}
{% block content %}
    <div class="custom_container">
        <form method="post">
            {% csrf_token %}
            <h4>{{ age_question.question_title }}</h4>
            <input type="text" name="age_answer" placeholder="{{ age_question.question_title }}">
            <h4>{{ marriage_question.question_title }}</h4>
            <select name="marriage_answer">
                {% for option in marriage_question.options.all %}
                    <option value="{{ option.option_value }}">{{ option.option_title }} </option>
                {% endfor %}
            </select>
            <div class="children hide">
                <h4>{{ children_question.question_title }}</h4>
                <input type="text" class="child" name="children_answer"
                       placeholder="{{ children_question.question_title }}">
                <div class="table_place">

                </div>
            </div>
            <button type="submit" class="btn btn-primary btn-lg">ادامه</button>
        </form>
    </div>
{% endblock %}
{% block js %}
    <script type="application/javascript">
        const child = $('.child')

        function show_child(number_of_child) {
            let table_place = $('.table_place')
            if (number_of_child > 0) {
                result = '<table style="border: none" class="table"><thead><tr><th>فرزند</th><th>جنسیت</th><th>سال تولد</th><th>محاسبه سن اتومات</th></tr></thead><tbody>'
                for (let i = 1; i <= number_of_child; i++) {
                    result += '<tr><td>' + i + '</td>' +
                        '<td><select class="form-select" name="gender_' + i + '"><option value="male">پسر</option><option value="female">دختر</option></select></td>' +
                        '<td><input type="number" class="year form-control" name="year_' + i + '" placeholder="سال تولد" maxlength="4"></td>' +
                        '<td><input class="form-control" type="text" name="age_' + i + '" disabled></td>' +
                        '</tr>'
                }
                result += '</tbody></table>'
                table_place.html(result)
            } else {
                table_place.html('')
            }
            let years = $('input.year')
            years.keyup(function () {
                if (this.value.length == 4) {
                    var result
                    var serializedData = $(this).serialize();
                    $.ajax({
                        url: '{% url 'Survey:question_get_age' %}',
                        data: serializedData,
                        async:false,
                        success: function (response) {
                            result = JSON.stringify(response['age'])
                        }
                    });
                    console.log(result)
                    if (this.name == 'year_1') {
                        $('input[name=age_1]').val(result)

                    } else if (this.name == 'year_2') {
                        $('input[name=age_2]').val(result)

                    } else if (this.name == 'year_3') {
                        $('input[name=age_3]').val(result)

                    }
                }
            })
        }

        child.keyup(function () {
            let row_number = 3
            if (this.value < 3) {
                row_number = this.value
            }

            show_child(row_number)
        });

        let marriage_status = $('select[name=marriage_answer]')
        marriage_status.change(function () {
            if (this.value == 2 || this.value == 3 || this.value == 4) {
                $('div .children').removeClass('hide')
            } else {
                $('div .children').addClass('hide')
            }
        });

    </script>
{% endblock %}